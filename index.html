<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overall Cohort Statistics Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2rem;
            line-height: 1.6;
        }
        h1 {
            margin-bottom: 0.5rem;
        }
        p {
            margin-top: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 0.5rem;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        input[type="number"] {
            width: 6rem;
            padding: 0.3rem;
        }
        .btn {
            margin-top: 1rem;
            padding: 0.6rem 1.2rem;
            font-size: 1rem;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        .btn:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 1.5rem;
            font-weight: bold;
            font-size: 1.1rem;
        }
        label {
            display: block;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <h1>Overall Cohort Statistics Calculator</h1>
    <p>
        Use this tool to combine the sample size (<em>n</em>), mean and standard deviation (SD) of up to 10 subgroups and obtain the overall mean, standard deviation and total sample size. All inputs are required for each subgroup. The calculations use the pooled sample variance formula.
    </p>
    <label for="numGroups"><strong>Number of studies (2–10):</strong></label>
<input id="numGroups"
       type="number"
       min="2"
       max="10"
       step="1"
       value="2"
       inputmode="numeric"
       pattern="[0-9]*"
       style="width: 80px; margin-left: 6px;" />
    <table id="inputTable">
        <thead>
            <tr>
                <th>Group</th>
                <th>Sample Size (n)</th>
                <th>Mean</th>
                <th>Standard Deviation (SD)</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be inserted here by JavaScript -->
        </tbody>
    </table>
    <button id="calculateBtn" class="btn">Calculate</button>
    <div id="results" class="result"></div>
    <script>
    (function() {
        const numGroupsInput = document.getElementById('numGroups');
        const inputTableBody = document.getElementById('inputTable').querySelector('tbody');

        function createRows() {
            const num = parseInt(numGroupsInput.value) || 0;
            // Enforce bounds 1‑10
            const boundedNum = Math.max(1, Math.min(10, num));
            numGroupsInput.value = boundedNum;
            // Clear existing rows
            inputTableBody.innerHTML = '';
            for (let i = 1; i <= boundedNum; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${i}</td>
                    <td><input type="number" min="0" step="1" id="n_${i}" required></td>
                    <td><input type="number" step="any" id="mean_${i}" required></td>
                    <td><input type="number" step="any" id="sd_${i}" required></td>
                `;
                inputTableBody.appendChild(row);
            }
        }

        // Initialize on page load
        createRows();
        // Update rows when number of groups changes
        numGroupsInput.addEventListener('change', createRows);
        numGroupsInput.addEventListener('input', createRows);

        // Perform calculations
        document.getElementById('calculateBtn').addEventListener('click', function() {
            const num = parseInt(numGroupsInput.value) || 0;
            if (num < 1 || num > 10) {
                alert('Please specify a number of subgroups between 1 and 10.');
                return;
            }
            let totalN = 0;
            let weightedMeanNumerator = 0;
            const ns = [];
            const means = [];
            const sds = [];
            for (let i = 1; i <= num; i++) {
                const nVal = document.getElementById(`n_${i}`).value;
                const meanVal = document.getElementById(`mean_${i}`).value;
                const sdVal = document.getElementById(`sd_${i}`).value;
                const n = parseFloat(nVal);
                const m = parseFloat(meanVal);
                const sd = parseFloat(sdVal);
                if (isNaN(n) || isNaN(m) || isNaN(sd)) {
                    alert('Please fill in all fields for subgroup ' + i + '.');
                    return;
                }
                if (n < 0) {
                    alert('Sample size cannot be negative (group ' + i + ').');
                    return;
                }
                ns.push(n);
                means.push(m);
                sds.push(sd);
                totalN += n;
                weightedMeanNumerator += n * m;
            }
            if (totalN <= 0) {
                alert('Total sample size must be greater than 0.');
                return;
            }
            const overallMean = weightedMeanNumerator / totalN;
            let sumTerms = 0;
            for (let i = 0; i < num; i++) {
                const ni = ns[i];
                const sd_i = sds[i];
                const mean_i = means[i];
                // (n_i - 1) * SD_i^2 + n_i * (mean_i - overallMean)^2
                sumTerms += (ni - 1) * Math.pow(sd_i, 2) + ni * Math.pow(mean_i - overallMean, 2);
            }
            const overallVariance = sumTerms / (totalN - 1);
            const overallSD = Math.sqrt(overallVariance);
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            const resultLines = [];
            resultLines.push(`Total sample size (N): ${totalN.toFixed(0)}`);
            resultLines.push(`Overall mean: ${overallMean.toFixed(4)}`);
            resultLines.push(`Overall standard deviation: ${overallSD.toFixed(4)}`);
            resultsDiv.innerHTML = resultLines.map(l => `<p>${l}</p>`).join('');
        });
    })();
    </script>
</body>
</html>
